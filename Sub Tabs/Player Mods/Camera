--==============================================================================
--                    AEGIS HUB - CAMERA MODULE (FIXED)
--==============================================================================

local AegisHub = _G.AegisHub
if not AegisHub or not AegisHub.CameraPage then 
    warn("Aegis Hub not loaded!") 
    return 
end

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local page = AegisHub.CameraPage
local Library = AegisHub.Library  -- FIX: Get Library from AegisHub

-- State
local State = {
    fovEnabled = false,
    fovValue = 70,
    
    freecamEnabled = false,
    freecamCamera = nil,
    
    connections = {}
}

-- Helper functions
local function getChar() return player.Character end
local function getHRP() local c = getChar() return c and c:FindFirstChild("HumanoidRootPart") end

-- FOV
local function enableFOV()
    local cam = Workspace.CurrentCamera
    if cam then 
        cam.FieldOfView = State.fovValue 
    end
end

local function disableFOV()
    local cam = Workspace.CurrentCamera
    if cam then 
        cam.FieldOfView = 70 
    end
end

-- FreeCam
local function enableFreeCam()
    -- Load and execute freecam script
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Roblox-Freecam/Freecam/main/Main.lua"))()
    end)
end

-- Character respawn handler
table.insert(State.connections, player.CharacterAdded:Connect(function()
    task.wait(0.3)
    
    if State.fovEnabled then enableFOV() end
end))

-- Create UI
-- FOV
Library:CreateToggle(page, "FOV", false, function(v)
    State.fovEnabled = v
    if v then enableFOV() else disableFOV() end
end)

Library:CreateSlider(page, "FOV Value", 10, 150, 70, function(v)
    State.fovValue = v
    if State.fovEnabled then
        local cam = Workspace.CurrentCamera
        if cam then cam.FieldOfView = v end
    end
end)

-- FreeCam
Library:CreateToggle(page, "FreeCam", false, function(v)
    State.freecamEnabled = v
    if v then
        enableFreeCam()
    end
end)

print("âœ“ Camera Module Loaded")

return true
