-- MODULE 1: Money and Pickaxe Auto-Purchase System (STANDALONE) - FAST VERSION
-- This module handles money collection and pickaxe purchasing

local Module1 = {}

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Configuration
Module1.Config = {
    PICKAXE_COST = 25,
    PICKAXE_TELEPORT = Vector3.new(-240, 13, -839),
    SCRAP_NAME = "Scrap_Generate_ERROR"
}

-- Initialize player references
function Module1:Init()
    self.player = Players.LocalPlayer
    self.character = self.player.Character or self.player.CharacterAdded:Wait()
    self.humanoidRootPart = self.character:WaitForChild("HumanoidRootPart")
    
    -- Handle character respawn
    self.player.CharacterAdded:Connect(function(newCharacter)
        self.character = newCharacter
        self.humanoidRootPart = newCharacter:WaitForChild("HumanoidRootPart")
    end)
    
    print("[Module 1] Initialized - Money and Pickaxe System (FAST)")
end

-- Check if player has pickaxe in inventory
function Module1:HasPickaxe()
    local backpack = self.player:WaitForChild("Backpack")
    local characterTools = self.character:GetChildren()
    
    -- Check backpack
    if backpack:FindFirstChild("Pickaxe") then
        return true
    end
    
    -- Check equipped tools
    for _, item in pairs(characterTools) do
        if item:IsA("Tool") and item.Name == "Pickaxe" then
            return true
        end
    end
    
    return false
end

-- Get player's current money
function Module1:GetPlayerMoney()
    local moneyValue = self.player:WaitForChild("stats"):WaitForChild("Money")
    return moneyValue.Value
end

-- Purchase pickaxe from merchant
function Module1:PurchasePickaxe()
    print("[Module 1] Purchasing Pickaxe...")
    
    -- Teleport to purchase location
    self.humanoidRootPart.CFrame = CFrame.new(self.Config.PICKAXE_TELEPORT)
    
    -- Execute purchase immediately
    local args = {
        "Pickaxe",
        "LINKON_CS"
    }
    ReplicatedStorage:WaitForChild("MERCHANT"):WaitForChild("MClientCommunication"):FireServer(unpack(args))
    
    print("[Module 1] Purchase command sent")
end

-- Find all scrap generators in workspace
function Module1:FindScrapGenerators()
    local scraps = {}
    local workspace = game:GetService("Workspace")
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj.Name == self.Config.SCRAP_NAME then
            table.insert(scraps, obj)
        end
    end
    
    return scraps
end

-- Collect from a single scrap generator
function Module1:CollectFromScrap(scrapObject)
    -- Find ProximityPrompt
    local proximityPrompt = scrapObject:FindFirstChildOfClass("ProximityPrompt", true)
    
    if not proximityPrompt then
        return false
    end
    
    -- Check if already disabled
    if not proximityPrompt.Enabled then
        return false
    end
    
    -- Teleport to scrap
    local scrapPosition = scrapObject:IsA("BasePart") and scrapObject.Position or scrapObject:FindFirstChildWhichIsA("BasePart", true).Position
    self.humanoidRootPart.CFrame = CFrame.new(scrapPosition)
    
    -- Modify HoldDuration to 0
    proximityPrompt.HoldDuration = 0
    
    -- Keep firing until disabled
    while proximityPrompt.Enabled do
        fireproximityprompt(proximityPrompt)
        task.wait() -- Minimal wait just to yield
        
        if not proximityPrompt.Enabled then
            return true
        end
    end
    
    return true
end

-- Main execution loop
function Module1:Run()
    while true do
        task.wait() -- Minimal wait
        
        -- Update character reference
        self.character = self.player.Character or self.player.CharacterAdded:Wait()
        self.humanoidRootPart = self.character:WaitForChild("HumanoidRootPart")
        
        -- Check if player already has pickaxe
        if self:HasPickaxe() then
            print("[Module 1] ✓ Player has Pickaxe! Module 1 complete.")
            
            print("[Module 1] ========================================")
            print("[Module 1] LOADING NEXT SCRIPT...")
            print("[Module 1] ========================================")
            
            -- Load Module 2
            loadstring(game:HttpGet("https://raw.githubusercontent.com/crazyhamster82/expert-adventure/refs/heads/main/Auto%20Reactor%20Meltdown%20Modules/2%20Module%20Mine%201%20Fedorlite%20Then%20Sell%20Then%20Purchase%20Resparator%20and%20Filter?token=GHSAT0AAAAAADR6MV2JHTSYDZEXVWEXFBYW2K3AJWQ", true))()
            
            print("[Module 1] ========================================")
            print("[Module 1] NEXT SCRIPT LOADED - MODULE 1 STOPPING")
            print("[Module 1] ========================================")
            
            return true
        end
        
        -- Get current money
        local currentMoney = self:GetPlayerMoney()
        
        -- Check if player can afford pickaxe
        if currentMoney >= self.Config.PICKAXE_COST then
            print("[Module 1] Money: " .. currentMoney .. " - Buying pickaxe...")
            self:PurchasePickaxe()
            
            -- Check immediately if pickaxe was acquired
            task.wait()
            if self:HasPickaxe() then
                print("[Module 1] ✓ Pickaxe purchased!")
                
                print("[Module 1] ========================================")
                print("[Module 1] LOADING NEXT SCRIPT...")
                print("[Module 1] ========================================")
                
                -- Load Module 2
                loadstring(game:HttpGet("https://raw.githubusercontent.com/gamedev1164/hhkalskjdfg/refs/heads/main/Reactor/Module%202", true))()
                
                print("[Module 1] ========================================")
                print("[Module 1] NEXT SCRIPT LOADED - MODULE 1 STOPPING")
                print("[Module 1] ========================================")
                
                return true
            end
        else
            print("[Module 1] Money: " .. currentMoney .. "/" .. self.Config.PICKAXE_COST .. " - Collecting scraps...")
            
            -- Find all scrap generators
            local scraps = self:FindScrapGenerators()
            
            if #scraps == 0 then
                print("[Module 1] No scraps found!")
                task.wait()
            else
                -- Collect from each scrap
                for i, scrap in ipairs(scraps) do
                    self:CollectFromScrap(scrap)
                    task.wait() -- Minimal wait
                    
                    -- Check money after each collection
                    if self:GetPlayerMoney() >= self.Config.PICKAXE_COST then
                        break
                    end
                end
            end
        end
    end
end

-- STANDALONE EXECUTION - Runs automatically
print("========================================")
print("MODULE 1: Money & Pickaxe (FAST)")
print("========================================")

Module1:Init()
Module1:Run()

print("========================================")
print("MODULE 1: COMPLETE!")
print("========================================")
